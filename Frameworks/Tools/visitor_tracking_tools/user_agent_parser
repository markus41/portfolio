# Tools/visitor_tracking_tools/user_agent_parser.py

from ua_parser import user_agent_parser
from ..Engines.logger import get_logger

logger = get_logger(__name__)

class UserAgentParser:
    """
    Parse browser/OS/device from User-Agent string.
    """

    def __init__(self, regex_path: str = None):
        if regex_path:
            user_agent_parser.InstallParser(regex_path)

    def parse(self, ua_string: str) -> dict:
        logger.info("Parsing User-Agent")
        parsed = user_agent_parser.Parse(ua_string)
        return {
            "browser": parsed["user_agent"]["family"],
            "browser_version": f"{parsed['user_agent']['major']}.{parsed['user_agent']['minor']}",
            "os": parsed["os"]["family"],
            "device": parsed["device"]["family"],
        }
