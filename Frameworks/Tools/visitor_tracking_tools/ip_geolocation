# Tools/visitor_tracking_tools/ip_geolocation.py

import requests
from ..Engines.constants import IPINFO_TOKEN
from ..Engines.logger import get_logger

logger = get_logger(__name__)

class IPGeolocationTool:
    """
    Lookup IP -> geo data via ipinfo.io.
    """

    def __init__(self):
        self.base = "https://ipinfo.io"

    def lookup(self, ip: str) -> dict:
        url = f"{self.base}/{ip}/json"
        params = {"token": IPINFO_TOKEN} if IPINFO_TOKEN else {}
        logger.info(f"IP lookup for {ip}")
        resp = requests.get(url, params=params)
        resp.raise_for_status()
        return resp.json()
