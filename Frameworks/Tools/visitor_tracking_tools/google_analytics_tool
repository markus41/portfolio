# Tools/visitor_tracking_tools/google_analytics_tool.py

import requests
import uuid
from ..Engines.constants import GA4_MEASUREMENT_ID, GA4_API_SECRET
from ..Engines.logger import get_logger

logger = get_logger(__name__)

class GoogleAnalyticsTool:
    """
    Send events to GA4 via Measurement Protocol.
    """

    def __init__(self):
        self.endpoint = (
            f"https://www.google-analytics.com/mp/collect"
            f"?measurement_id={GA4_MEASUREMENT_ID}"
            f"&api_secret={GA4_API_SECRET}"
        )

    def track_event(self, client_id: str, name: str, params: dict = None) -> bool:
        payload = {
            "client_id": client_id,
            "events": [
                {
                    "name": name,
                    "params": params or {}
                }
            ]
        }
        logger.info(f"GA4 event: {name} for client {client_id}")
        resp = requests.post(self.endpoint, json=payload)
        return resp.status_code == 204
