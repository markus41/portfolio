# Tools/data_ingestion_tools/azure_blob_loader.py

from azure.storage.blob import BlobServiceClient
import pandas as pd
import io
from ..Engines.logger import get_logger
from ..Engines.constants import AZURE_BLOB_CONNECTION_STR, AZURE_BLOB_CONTAINER

logger = get_logger(__name__)

class AzureBlobLoader:
    def __init__(self):
        logger.info("Connecting to Azure Blob Service")
        self.client = BlobServiceClient.from_connection_string(AZURE_BLOB_CONNECTION_STR)
        self.container = self.client.get_container_client(AZURE_BLOB_CONTAINER)

    def download_csv(self, blob_name: str) -> pd.DataFrame:
        """
        Download a CSV blob and load into a DataFrame.
        """
        logger.info(f"Downloading blob '{blob_name}' as CSV")
        blob = self.container.download_blob(blob_name)
        data = blob.readall()
        df = pd.read_csv(io.BytesIO(data))
        logger.info(f"Loaded {len(df)} rows from blob")
        return df
