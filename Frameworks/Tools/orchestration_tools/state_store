# Tools/orchestration_tools/state_store.py

import redis
import json
from ..Engines.constants import REDIS_URL
from ..Engines.logger import get_logger

logger = get_logger(__name__)

class StateStore:
    """
    Simple Redis-backed state store for workflow steps.
    """

    def __init__(self):
        self.client = redis.from_url(REDIS_URL)

    def set_state(self, key: str, value: dict):
        logger.info(f"StateStore SET {key}")
        self.client.hset("workflow_state", key, json.dumps(value))

    def get_state(self, key: str) -> dict | None:
        raw = self.client.hget("workflow_state", key)
        if not raw:
            return None
        logger.info(f"StateStore GET {key}")
        return json.loads(raw)
