# lead_capture.py
from fastapi import FastAPI, Header
from azure.servicebus import ServiceBusClient
import json

app = FastAPI()
sb = ServiceBusClient.from_connection_string(os.getenv("SB_CONN"))

@app.post("/capture/web")
async def capture(form: dict, x_tenant: str = Header(...)):
    event = {"tenant_id": x_tenant, **form}
    msg = sb.get_queue_sender("lead-forms").send_messages(
        ServiceBusMessage(json.dumps(event)))
    return {"status": "queued"}