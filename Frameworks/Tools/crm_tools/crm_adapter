interface Lead { email: string; company: string; }
class CrmAdapter {
  async findDuplicate(lead: Lead): Promise<string|null> {
    // call CRM search API
    return null;
  }

  async upsert(lead: Lead, idempotencyKey: string) {
    const dupId = await this.findDuplicate(lead);
    if (dupId) {
      await this.attachActivity(dupId, lead);
    } else {
      await this.createContact(lead, idempotencyKey);
    }
  }
}