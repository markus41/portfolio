# Tools/payment_tools/plaid_tool.py

from plaid import Client
from ..Engines.constants import PLAID_CLIENT_ID, PLAID_SECRET, PLAID_ENVIRONMENT
from ..Engines.logger import get_logger

logger = get_logger(__name__)

plaid_client = Client(client_id=PLAID_CLIENT_ID, secret=PLAID_SECRET, environment=PLAID_ENVIRONMENT)

class PlaidTool:
    """
    Link and verify bank accounts via Plaid.
    """

    def create_link_token(self, user_id: str, client_name="Brookside BI", products=["auth"]) -> dict:
        logger.info(f"Plaid create_link_token for user {user_id}")
        return plaid_client.LinkToken.create({
            "user": {"client_user_id": user_id},
            "client_name": client_name,
            "products": products,
            "country_codes": ["US"],
            "language": "en"
        })

    def exchange_public_token(self, public_token: str) -> dict:
        logger.info("Plaid exchange_public_token")
        return plaid_client.Item.public_token.exchange(public_token)

    def get_account_info(self, access_token: str) -> dict:
        logger.info("Plaid get_account_info")
        return plaid_client.Accounts.get(access_token)
